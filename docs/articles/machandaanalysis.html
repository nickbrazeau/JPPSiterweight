<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Recreating the Analysis from <em>Machanda et al. 2019</em>-Growing Up Chimpanzee • JPPSiterweight</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Recreating the Analysis from <em>Machanda et al. 2019</em>-Growing Up Chimpanzee" />

<meta property="og:description" content="" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-article">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">JPPSiterweight</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/machandaanalysis.html">Recreating the Analysis from _Machanda et al. 2019_-Growing Up Chimpanzee</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>


<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Recreating the Analysis from <em>Machanda et al. 2019</em>-Growing Up Chimpanzee</h1>
            
            <h4 class="date">2019-06-27</h4>
      
      
      <div class="hidden name"><code>machandaanalysis.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(JPPSiterweight)
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(cowplot)</code></pre></div>
</div>
<div id="data" class="section level1">
<h1>Data</h1>
<p>Here we will use the data from <em>Machanda et al. 2019</em> to explore the JPPS functionality.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># </span><span class="al">TODO</span><span class="co"> usethis::use_data </span>
<span class="co"># </span>
dat &lt;-<span class="st"> </span>readxl<span class="op">::</span><span class="kw">read_excel</span>(<span class="dt">path =</span> <span class="st">&quot;~/Downloads/average body area and length_kanyawara 2012.xlsx&quot;</span>, <span class="dt">sheet =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>magrittr<span class="op">::</span><span class="kw">set_colnames</span>(<span class="kw">tolower</span>(<span class="kw">colnames</span>(.))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(
    <span class="dt">lengthcubed =</span> avg.length<span class="op">^</span><span class="dv">3</span>
    
  )</code></pre></div>
</div>
<div id="model-specifications" class="section level1">
<h1>Model Specifications</h1>
<p>In this paper, we were interested in analyzing wild chimpanzee growth curves and exploring differences in cpative versus wild chimpanzee growth, as well as any sex-differences in growth. In this vignette, we will hone in on the Kanyawara chimpanzees body-length and explore differences in growth trajectory by sex. As a result, we will fit models for males, females, and all chimpanzees within each community respectively.</p>
<p>Below, we specify some starting parameters that will be needed for later model fitting. These parameters were taken from <a href="https://www.ncbi.nlm.nih.gov/pubmed/8928723">Leigh &amp; Shea 1996</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
adult.meanlength.all &lt;-<span class="st"> </span><span class="kw">mean</span>( dat<span class="op">$</span>avg.length[dat<span class="op">$</span>age <span class="op">&gt;</span><span class="st"> </span><span class="dv">15</span>] )
adult.meanlength.male &lt;-<span class="st"> </span><span class="kw">mean</span>( dat<span class="op">$</span>avg.length[dat<span class="op">$</span>age <span class="op">&gt;</span><span class="st"> </span><span class="dv">15</span> <span class="op">&amp;</span><span class="st"> </span>dat<span class="op">$</span>sex <span class="op">==</span><span class="st"> &quot;M&quot;</span>] )
adult.meanlength.female &lt;-<span class="st"> </span><span class="kw">mean</span>( dat<span class="op">$</span>avg.length[dat<span class="op">$</span>age <span class="op">&gt;</span><span class="st"> </span><span class="dv">15</span> <span class="op">&amp;</span><span class="st"> </span>dat<span class="op">$</span>sex <span class="op">==</span><span class="st"> &quot;F&quot;</span>] )


<span class="co"># from Leigh &amp; Shea 1996 (Yerkes data)</span>
par.init.all &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">B =</span> adult.meanlength.all,
                  <span class="dt">D1 =</span> <span class="fl">8.835</span> , <span class="dt">D2 =</span> <span class="fl">9.450</span>, <span class="dt">D3 =</span> <span class="fl">28.465</span>, <span class="dt">C1 =</span> <span class="fl">3.355</span>, <span class="dt">C2 =</span> <span class="fl">12.990</span>, <span class="dt">C3 =</span> <span class="fl">1.005</span>) 
                  <span class="co"># these are averages</span>

par.init.female &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">B =</span> adult.meanlength.female, 
                     <span class="dt">D1 =</span> <span class="fl">8.48</span> , <span class="dt">D2 =</span> <span class="fl">8.93</span>, <span class="dt">D3 =</span> <span class="fl">44.81</span>, <span class="dt">C1 =</span> <span class="fl">1.92</span>, <span class="dt">C2 =</span> <span class="fl">6.95</span>, <span class="dt">C3 =</span> <span class="fl">0.79</span>)

par.init.male &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">B =</span> adult.meanlength.male,
                   <span class="dt">D1 =</span> <span class="fl">9.19</span> , <span class="dt">D2 =</span> <span class="fl">9.97</span>, <span class="dt">D3 =</span> <span class="fl">12.12</span>, <span class="dt">C1 =</span> <span class="fl">4.79</span>, <span class="dt">C2 =</span> <span class="fl">19.03</span>, <span class="dt">C3 =</span> <span class="fl">1.22</span>)</code></pre></div>
<p>We are going to fit two formulations of the JPPS non-linear parametric model: (1) Ordinary Non-linear Least Squares (ONLS) and (2) Iteratively Reweighted Non-linear Least Squares (IRNLS). For each model form, we start with a pre-specified set of parameters (shown above) and fit the model/estimate parameters by minimizing the residual sum of squares (through optimization, specifically Simulated Annealing although other optimizers are warranted and can be easily incorporated). We then run these models many, many times (“replicates”) in order to form a sampling distribtuion of the parameter estimates. From this distribution, we then calulcate a 95% confidence interval for each respective parameter estimate (i.e. a non-parametric approach).</p>
<p>The ONLS and IRNLS largely differ in their approach to handle the heteroscedasticity that is observed in our data (e.g. variance in size is correlated with increased in age). The ONLS model assumes constant variance (homoscedasticity) and does not account for this variance deviation. In contrast, the IRNLS model weights each individual data point in a manner that attempts to reduce the variance (reduced through minimizing the sum of squares of a linear model fit with the residuals as the regressors and the predicted values of Y (y-hat) used as weights). This weighted approach allows for heteroscedasticity to better “controlled” for and not violate the base assumption of least-squares.</p>
<p>Here, I have specifed a few number of replicates to create the sampling distributions. In your own analyses, you will want to increase this for accuracy (versus computation time).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">reps &lt;-<span class="st"> </span><span class="fl">1e2</span></code></pre></div>
<div id="ordiniary-unweighted-models" class="section level2">
<h2>Ordiniary (Unweighted) Models</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># faster for loop</span>
ret.ord &lt;-<span class="st"> </span>parallel<span class="op">::</span><span class="kw">mclapply</span>(<span class="dv">1</span><span class="op">:</span>reps, <span class="dt">FUN =</span> <span class="cf">function</span>(x){ 
  JPPSiterweight<span class="op">::</span><span class="kw">optimize.jpps.ord</span>(
    <span class="dt">ind.obs =</span> dat<span class="op">$</span>age,
    <span class="dt">dep.obs =</span> dat<span class="op">$</span>avg.length,
    <span class="dt">params =</span> par.init.all)
})


<span class="co"># let&#39;s bind our replications together into a dataframe</span>
ret.ord.params &lt;-<span class="st"> </span>ret.ord <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>purrr<span class="op">::</span><span class="kw">map</span>(., <span class="st">&quot;params&quot;</span>) 
ret.ord.params &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">do.call</span>(rbind, ret.ord.params))

<span class="co"># let&#39;s summarize and 2.5th, 50th, and 97.5 probabilities</span>
ret.ord.params.summ &lt;-<span class="st"> </span><span class="kw">apply</span>(ret.ord.params, <span class="dv">2</span>, quantile, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))

knitr<span class="op">::</span><span class="kw">kable</span>(ret.ord.params.summ)</code></pre></div>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">B</th>
<th align="right">D1</th>
<th align="right">D2</th>
<th align="right">D3</th>
<th align="right">C1</th>
<th align="right">C2</th>
<th align="right">C3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2.5%</td>
<td align="right">60.07006</td>
<td align="right">4.326987</td>
<td align="right">7.363736</td>
<td align="right">20.78468</td>
<td align="right">0.3970604</td>
<td align="right">4.197896</td>
<td align="right">0.1696776</td>
</tr>
<tr class="even">
<td>50%</td>
<td align="right">60.80549</td>
<td align="right">5.624139</td>
<td align="right">8.348464</td>
<td align="right">28.07473</td>
<td align="right">1.1563587</td>
<td align="right">5.631796</td>
<td align="right">0.2138735</td>
</tr>
<tr class="odd">
<td>97.5%</td>
<td align="right">61.11585</td>
<td align="right">7.918715</td>
<td align="right">10.253161</td>
<td align="right">35.33821</td>
<td align="right">1.9867907</td>
<td align="right">15.391279</td>
<td align="right">0.7895386</td>
</tr>
</tbody>
</table>
<div id="predictions-and-plotting" class="section level4">
<h4>Predictions and Plotting</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># let&#39;s get predictions from our model</span>
predictions_grwth &lt;-<span class="st"> </span><span class="kw">predict</span>(<span class="kw">makeJPPS.firstorder_obj</span>(ret.ord.params.summ[<span class="dv">2</span>,]), <span class="dt">x =</span> <span class="kw">seq</span>(<span class="fl">0.01</span>, <span class="dv">50</span>, <span class="dt">by =</span> <span class="fl">0.01</span>)) <span class="co"># make fine scale for geom_line so it does not have disjointed connections</span>
predictions_grwth.lowerCI &lt;-<span class="st"> </span><span class="kw">predict</span>(<span class="kw">makeJPPS.firstorder_obj</span>(ret.ord.params.summ[<span class="dv">1</span>,]), <span class="dt">x =</span> <span class="kw">seq</span>(<span class="fl">0.01</span>, <span class="dv">50</span>, <span class="dt">by =</span> <span class="fl">0.01</span>)) <span class="co"># make fine scale for geom_line so it does not have disjointed connections</span>
predictions_grwth.upperCI &lt;-<span class="st"> </span><span class="kw">predict</span>(<span class="kw">makeJPPS.firstorder_obj</span>(ret.ord.params.summ[<span class="dv">3</span>,]), <span class="dt">x =</span> <span class="kw">seq</span>(<span class="fl">0.01</span>, <span class="dv">50</span>, <span class="dt">by =</span> <span class="fl">0.01</span>)) <span class="co"># make fine scale for geom_line so it does not have disjointed connections</span>
predictions_grwth.CI &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">left_join</span>(predictions_grwth.lowerCI, predictions_grwth.upperCI, <span class="dt">by =</span> <span class="st">&quot;age&quot;</span>)


predictions_veloc &lt;-<span class="st"> </span><span class="kw">predict</span>(<span class="kw">makeJPPS.secondorder_obj</span>(ret.ord.params.summ[<span class="dv">2</span>,]), <span class="dt">x =</span> <span class="kw">seq</span>(<span class="fl">0.01</span>, <span class="dv">50</span>, <span class="dt">by =</span> <span class="fl">0.01</span>)) <span class="co"># if you set velocity to 0 it will be INF because JPPS forces the model to go through 0</span>
predictions_veloc.lowerCI &lt;-<span class="st"> </span><span class="kw">predict</span>(<span class="kw">makeJPPS.secondorder_obj</span>(ret.ord.params.summ[<span class="dv">1</span>,]), <span class="dt">x =</span> <span class="kw">seq</span>(<span class="fl">0.01</span>, <span class="dv">50</span>, <span class="dt">by =</span> <span class="fl">0.01</span>)) <span class="co"># if you set velocity to 0 it will be INF because JPPS forces the model to go through 0</span>
predictions_veloc.upperCI &lt;-<span class="st"> </span><span class="kw">predict</span>(<span class="kw">makeJPPS.secondorder_obj</span>(ret.ord.params.summ[<span class="dv">3</span>,]), <span class="dt">x =</span> <span class="kw">seq</span>(<span class="fl">0.01</span>, <span class="dv">50</span>, <span class="dt">by =</span> <span class="fl">0.01</span>)) <span class="co"># if you set velocity to 0 it will be INF because JPPS forces the model to go through 0</span>

predictions_veloc.CI &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">left_join</span>(predictions_veloc.lowerCI, predictions_veloc.upperCI, <span class="dt">by =</span> <span class="st">&quot;age&quot;</span>)</code></pre></div>
</div>
<div id="plotting-the-outcome" class="section level4">
<h4>Plotting the Outcome</h4>
<p>Now that we have predictions, we want to plot the growth trajectory and the velocity interval. We are going to explore the <code>cowplot</code> package and an inset plot with growth trajectory and growth, respectively.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># you can really custom the plot however you want with ggplot</span>
grwth_traj.plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> predictions_grwth, <span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> outcome), <span class="dt">color =</span> <span class="st">&quot;#08306b&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="dt">data =</span> predictions_grwth.CI, <span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">ymin =</span> outcome.y, <span class="dt">ymax =</span> outcome.x), <span class="dt">color =</span> <span class="ot">NA</span>, <span class="dt">fill =</span> <span class="st">&quot;#c6dbef&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Age (years)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Growth (cm)&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="co"># ggtitle(&quot;Growth over Age for All Individuals&quot;) +</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Helvetica&quot;</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">hjust =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="dv">10</span>), 
                     <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Helvetica&quot;</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">hjust =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="dv">8</span>), 
                     <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Helvetica&quot;</span>, <span class="dt">hjust =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="dv">7</span>), 
                     <span class="dt">legend.position =</span> <span class="st">&quot;right&quot;</span>,
                     <span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Helvetica&quot;</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">vjust =</span> <span class="fl">0.85</span>, <span class="dt">size =</span> <span class="dv">8</span>),
                     <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Helvetica&quot;</span>, <span class="dt">hjust =</span> <span class="fl">0.5</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">size =</span> <span class="dv">7</span>),
                     <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>),
                     <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>),
                     <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),
                     <span class="dt">panel.border =</span> <span class="kw">element_blank</span>())



<span class="co"># you can really custom the plot however you want with ggplot</span>
grwth_veloc.plot &lt;-<span class="st"> </span>predictions_veloc <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">y =</span> outcome), <span class="dt">color =</span> <span class="st">&quot;#08306b&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_ribbon</span>(<span class="dt">data =</span> predictions_veloc.CI, <span class="kw">aes</span>(<span class="dt">x =</span> age, <span class="dt">ymin =</span> outcome.x, <span class="dt">ymax =</span> outcome.y), <span class="dt">color =</span> <span class="ot">NA</span>, <span class="dt">fill =</span> <span class="st">&quot;#c6dbef&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.4</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;Age (years)&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Growth (cm/year)&quot;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Growth Trajectories by Age for All Individuals&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylim</span>(<span class="dv">0</span>,<span class="dv">8</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Helvetica&quot;</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">hjust =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="dv">14</span>), 
                     <span class="dt">axis.title =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Helvetica&quot;</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">hjust =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="dv">12</span>), 
                     <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Helvetica&quot;</span>, <span class="dt">hjust =</span> <span class="fl">0.5</span>, <span class="dt">size =</span> <span class="dv">11</span>), 
                     <span class="dt">legend.position =</span> <span class="st">&quot;right&quot;</span>,
                     <span class="dt">legend.title =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Helvetica&quot;</span>, <span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">vjust =</span> <span class="fl">0.85</span>, <span class="dt">size =</span> <span class="dv">12</span>),
                     <span class="dt">legend.text =</span> <span class="kw">element_text</span>(<span class="dt">family =</span> <span class="st">&quot;Helvetica&quot;</span>, <span class="dt">hjust =</span> <span class="fl">0.5</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">size =</span> <span class="dv">10</span>),
                     <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>),
                     <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>),
                     <span class="dt">panel.grid =</span> <span class="kw">element_blank</span>(),
                     <span class="dt">panel.border =</span> <span class="kw">element_blank</span>())




fullplot &lt;-<span class="st"> </span><span class="kw">ggdraw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">draw_plot</span>(grwth_veloc.plot) <span class="op">+</span>
<span class="st">  </span><span class="kw">draw_plot</span>(grwth_traj.plot, <span class="dt">x =</span> <span class="fl">0.6</span>, <span class="dt">y =</span> .<span class="dv">7</span>, <span class="dt">width =</span> .<span class="dv">4</span>, <span class="dt">height =</span> .<span class="dv">2</span>) 

<span class="kw">plot</span>(fullplot)</code></pre></div>
<p><img src="machandaanalysis_files/figure-html/unnamed-chunk-7-1.png" width="528" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># when we are satisified with the placements, we can write this out for publication</span>
<span class="co">#svglite::svglite(file = &quot;~/Desktop/full_comb_growthtraj.svg&quot;, width = 11, height = 8)</span>
<span class="co">#plot(fullplot)</span>
<span class="co">#graphics.off()</span></code></pre></div>
</div>
</div>
<div id="weighted-models" class="section level2">
<h2>Weighted Models</h2>
<p>Now we will move on to the IRNLS models and account for our heteroscedasticity.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">

<span class="co"># faster for loop</span>
ret.irnls &lt;-<span class="st"> </span>parallel<span class="op">::</span><span class="kw">mclapply</span>(<span class="dv">1</span><span class="op">:</span>reps, <span class="cf">function</span>(x){
               JPPSiterweight<span class="op">::</span><span class="kw">optimize.jpps.iteratively_reweight</span>(<span class="dt">par =</span> par.init.all,
                                                                  <span class="dt">optim.method =</span> <span class="st">&quot;SANN&quot;</span>,
                                                                  <span class="dt">iter.method =</span> <span class="st">&quot;Nelder&quot;</span>,
                                                                  <span class="dt">tol =</span> <span class="fl">1e-9</span>, <span class="co"># tolerance</span>
                                                                  <span class="dt">maxit =</span> <span class="dv">500</span>, <span class="co"># number of iterative weight steps to perform</span>
                                                                  <span class="dt">ind.obs =</span> dat<span class="op">$</span>age,
                                                                  <span class="dt">dep.obs =</span> dat<span class="op">$</span>avg.length)
                              })</code></pre></div>
<p>Here we will just print the summary.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ret.irnls.params &lt;-<span class="st"> </span>ret.irnls <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>purrr<span class="op">::</span><span class="kw">map</span>(., <span class="st">&quot;params&quot;</span>)
ret.irnls.params &lt;-<span class="st">  </span><span class="kw">as.data.frame</span>(<span class="kw">do.call</span>(rbind, ret.irnls.params))


<span class="co"># let&#39;s summarize and 2.5th, 50th, and 97.5 probabilities</span>
ret.irnls.params.summ &lt;-<span class="st"> </span><span class="kw">apply</span>(ret.irnls.params, <span class="dv">2</span>, quantile, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>))

knitr<span class="op">::</span><span class="kw">kable</span>(ret.irnls.params.summ)</code></pre></div>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">B</th>
<th align="right">D1</th>
<th align="right">D2</th>
<th align="right">D3</th>
<th align="right">C1</th>
<th align="right">C2</th>
<th align="right">C3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2.5%</td>
<td align="right">60.73795</td>
<td align="right">2.764230</td>
<td align="right">7.385284</td>
<td align="right">19.61176</td>
<td align="right">0.3803786</td>
<td align="right">4.220326</td>
<td align="right">0.3701726</td>
</tr>
<tr class="even">
<td>50%</td>
<td align="right">60.85737</td>
<td align="right">7.141700</td>
<td align="right">7.449051</td>
<td align="right">28.15754</td>
<td align="right">0.4340967</td>
<td align="right">4.322011</td>
<td align="right">0.4771508</td>
</tr>
<tr class="odd">
<td>97.5%</td>
<td align="right">60.95719</td>
<td align="right">9.460272</td>
<td align="right">7.549162</td>
<td align="right">35.46935</td>
<td align="right">0.4901077</td>
<td align="right">4.414502</td>
<td align="right">8.0181135</td>
</tr>
</tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul>
      <li><a href="#introduction">Introduction</a></li>
      <li><a href="#data">Data</a></li>
      <li><a href="#model-specifications">Model Specifications</a><ul>
      <li><a href="#ordiniary-unweighted-models">Ordiniary (Unweighted) Models</a></li>
      <li><a href="#weighted-models">Weighted Models</a></li>
      </ul></li>
      </ul>
    </div>
      </div>

</div>


      <footer>
      <div class="copyright">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>
